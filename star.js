function keyboardInit(){window.onkeydown=function(e){switch(e.keyCode){case 37:keyLeft=!0;break;case 38:keyUp=!0;break;case 39:keyRight=!0;break;case 40:keyDown=!0;break;case 32:case 75:keySpace=!0}e.preventDefault()},window.onkeyup=function(e){switch(e.keyCode){case 37:keyLeft=!1;break;case 38:keyUp=!1;break;case 39:keyRight=!1;break;case 40:keyDown=!1;break;case 75:case 32:keySpace=!1}e.preventDefault()}}function particleInit(){particlePool=Pool.create(Particle,100),particles=[]}function bulletInit(){bulletPool=Pool.create(Bullet,40),bullets=[]}function asteroidInit(){asteroidPool=Pool.create(Asteroid,70),asteroids=[]}function shipInit(){ship=Ship.create(screenWidth>>1,screenHeight>>1,this)}function loop(){updateShip(),updateParticles(),updateBullets(),updateAsteroids(),checkCollisions(),render(),getAnimationFrame(loop)}function updateShip(){ship.update(),ship.idle||(keySpace&&ship.shoot(),keyLeft&&(ship.angle-=.1),keyRight&&(ship.angle+=.1),keyUp?(ship.thrust.setLength(.1),ship.thrust.setAngle(ship.angle),generateThrustParticle()):(ship.vel.mul(.94),ship.thrust.setLength(0)),ship.pos.getX()>screenWidth?ship.pos.setX(0):ship.pos.getX()<0&&ship.pos.setX(screenWidth),ship.pos.getY()>screenHeight?ship.pos.setY(0):ship.pos.getY()<0&&ship.pos.setY(screenHeight))}function generateThrustParticle(){var e=particlePool.getElement();e&&(e.radius=12*Math.random()+5,e.color="rgba(255, 255, 0, "+(Math.random()+.2)+")",e.lifeSpan=40,e.pos.setXY(ship.pos.getX()+-14*Math.cos(ship.angle),ship.pos.getY()+-14*Math.sin(ship.angle)),e.vel.setLength(8/e.radius),e.vel.setAngle(ship.angle+(1-2*Math.random())*(Math.PI/18)),e.vel.mul(-1),particles[particles.length]=e)}function updateParticles(){var e=particles.length-1;for(e;e>-1;--e){var t=particles[e];t.blacklisted?(t.reset(),particles.splice(particles.indexOf(t),1),particlePool.disposeElement(t)):t.update()}}function updateBullets(){var e=bullets.length-1;for(e;e>-1;--e){var t=bullets[e];t.blacklisted?(t.reset(),bullets.splice(bullets.indexOf(t),1),bulletPool.disposeElement(t)):(t.update(),t.pos.getX()>screenWidth?t.blacklisted=!0:t.pos.getX()<0&&(t.blacklisted=!0),t.pos.getY()>screenHeight?t.blacklisted=!0:t.pos.getY()<0&&(t.blacklisted=!0))}}function updateAsteroids(){var e=asteroids.length-1;for(e;e>-1;--e){var t=asteroids[e];t.blacklisted?(t.reset(),asteroids.splice(asteroids.indexOf(t),1),asteroidPool.disposeElement(t)):(t.update(),t.pos.getX()>screenWidth+t.radius?t.pos.setX(-t.radius):t.pos.getX()<-t.radius&&t.pos.setX(screenWidth+t.radius),t.pos.getY()>screenHeight+t.radius?t.pos.setY(-t.radius):t.pos.getY()<-t.radius&&t.pos.setY(screenHeight+t.radius))}if(asteroids.length<30){var s=50*Math.random()>>0;generateAsteroid(screenWidth*s,screenHeight*s,80,"b")}}function generateAsteroid(e,t,s,i){var l=asteroidPool.getElement();l&&(l.color="rgba(255, 255, 255, "+(Math.random()+.5)+")",l.radius=s,l.type=i,l.pos.setXY(e,t),l.vel.setLength(.5+asteroidVelFactor),l.vel.setAngle(Math.random()*(2*Math.PI)),asteroids[asteroids.length]=l,asteroidVelFactor+=.02)}function checkCollisions(){checkBulletAsteroidCollisions(),checkShipAsteroidCollisions()}function checkBulletAsteroidCollisions(){var e,t=bullets.length-1;for(t;t>-1;--t)for(e=asteroids.length-1;e>-1;--e){var s=bullets[t],i=asteroids[e];checkDistanceCollision(s,i)&&(s.blacklisted=!0,destroyAsteroid(i),score+=1)}}function checkShipAsteroidCollisions(){var e=asteroids.length-1;for(e;e>-1;--e){var t=asteroids[e],s=ship;if(checkDistanceCollision(t,s)&&0==(life-=1)){if(s.idle)return;s.idle=!0,generateShipExplosion(),destroyAsteroid(t)}}}function generateShipExplosion(){var e=18;for(e;e>-1;--e){var t=particlePool.getElement();if(!t)return;t.radius=30*Math.random()+10,t.lifeSpan=120,t.color="#fff101",t.vel.setLength(80/t.radius),t.vel.setAngle(ship.angle+(1-2*Math.random())*doublePI),t.pos.setXY(ship.pos.getX()+Math.cos(t.vel.getAngle())*(.8*ship.radius),ship.pos.getY()+Math.sin(t.vel.getAngle())*(.8*ship.radius)),particles[particles.length]=t}}function checkDistanceCollision(e,t){var s=e.pos.getX()-t.pos.getX(),i=e.pos.getY()-t.pos.getY();return Vec2D.create(s,i).getLength()<e.radius+t.radius}function destroyAsteroid(e){e.blacklisted=!0,generateAsteroidExplosion(e),resolveAsteroidType(e)}function generateAsteroidExplosion(e){var t=18;for(t;t>-1;--t){var s=particlePool.getElement();if(!s)return;s.radius=Math.random()*(e.radius>>2)+8,s.lifeSpan=300,s.color="#FFF",s.vel.setLength(40/s.radius),s.vel.setAngle(ship.angle+(1-2*Math.random())*doublePI),s.pos.setXY(e.pos.getX()+Math.cos(s.vel.getAngle())*(.8*e.radius),e.pos.getY()+Math.sin(s.vel.getAngle())*(.8*e.radius)),particles[particles.length]=s}}function resolveAsteroidType(e){switch(e.type){case"b":generateAsteroid(e.pos.getX(),e.pos.getY(),60,"m"),generateAsteroid(e.pos.getX(),e.pos.getY(),50,"m");break;case"m":generateAsteroid(e.pos.getX(),e.pos.getY(),30,"s"),generateAsteroid(e.pos.getX(),e.pos.getY(),40,"s")}}function render(){ctx.fillStyle="rgb(20,20,20)",ctx.globalAlpha=.6,ctx.fillRect(0,0,screenWidth,screenHeight),ctx.globalAlpha=1,renderShip(),renderParticles(),renderBullets(),renderAsteroids()}function renderShip(){ship.idle||(ctx.save(),ctx.translate(ship.pos.getX()>>0,ship.pos.getY()>>0),ctx.rotate(ship.angle),ctx.fillStyle="#fff101",ctx.beginPath(),ctx.moveTo(25,0),ctx.lineTo(-20,-20),ctx.lineTo(-20,20),ctx.lineTo(25,0),ctx.fill(),ctx.closePath(),ctx.restore())}function renderParticles(){var e=particles.length-1;for(e;e>-1;--e){var t=particles[e],s=t.pos.getX(),i=t.pos.getY();ctx.beginPath(),ctx.moveTo(s,i+.68*t.radius),ctx.lineTo(s+.35*t.radius,i+.84*t.radius),ctx.lineTo(s+.5*t.radius,i+1.37*t.radius),ctx.lineTo(s+.64*t.radius,i+.84*t.radius),ctx.lineTo(s+t.radius,i+.68*t.radius),ctx.lineTo(s+.64*t.radius,i+.54*t.radius),ctx.lineTo(s+.5*t.radius,i),ctx.lineTo(s+.35*t.radius,i+.54*t.radius),ctx.lineTo(s,i+.68*t.radius),ctx.closePath(),ctx.fillStyle=t.color,ctx.fill(),ctx.closePath()}}function renderBullets(){var e=bullets.length-1;for(e;e>-1;--e){var t=bullets[e];t.color="#fff101",ctx.beginPath(),ctx.fillStyle=t.color,ctx.arc(t.pos.getX()>>0,t.pos.getY()>>0,t.radius,0,doublePI),Math.random()>.2&&ctx.fill(),ctx.closePath()}}function renderAsteroids(){var e=asteroids.length-1;for(e;e>-1;--e){var t=asteroids[e],s=t.pos.getX(),i=t.pos.getY();ctx.beginPath(),ctx.fillStyle=t.color;t.sides;ctx.moveTo(s,i+.9*t.radius),ctx.lineTo(s+.4*t.radius,i+.97*t.radius),ctx.lineTo(s+.2*t.radius,i+1.18*t.radius),ctx.lineTo(s+.45*t.radius,i+1.03*t.radius),ctx.lineTo(s+.5*t.radius,i+1.8*t.radius),ctx.lineTo(s+.55*t.radius,i+1.03*t.radius),ctx.lineTo(s+.8*t.radius,i+1.18*t.radius),ctx.lineTo(s+.6*t.radius,i+.97*t.radius),ctx.lineTo(s+t.radius,i+.9*t.radius),ctx.lineTo(s+.6*t.radius,i+.85*t.radius),ctx.lineTo(s+.8*t.radius,i+.63*t.radius),ctx.lineTo(s+.55*t.radius,i+.8*t.radius),ctx.lineTo(s+.5*t.radius,i),ctx.lineTo(s+.45*t.radius,i+.8*t.radius),ctx.lineTo(s+.2*t.radius,i+.63*t.radius),ctx.lineTo(s+.4*t.radius,i+.85*t.radius),ctx.lineTo(s,i+.9*t.radius),ctx.closePath(),ctx.fill()}}function generateShot(){var e=bulletPool.getElement();e&&(e.radius=3,e.pos.setXY(ship.pos.getX()+14*Math.cos(ship.angle),ship.pos.getY()+14*Math.sin(ship.angle)),e.vel.setLength(10),e.vel.setAngle(ship.angle),bullets[bullets.length]=e)}function resetGame(){asteroidVelFactor=0,ship.pos.setXY(screenWidth>>1,screenHeight>>1),ship.vel.setXY(0,0),score=0,life=9,resetAsteroids()}function resetAsteroids(){var e=asteroids.length-1;for(e;e>-1;--e)asteroids[e].blacklisted=!0}var Pool=function(){var e={_type:null,_size:null,_pointer:null,_elements:null,init:function(e,t){this._type=e,this._size=t,this._pointer=t,this._elements=[];var s=0,i=this._size;for(s;s<i;++s)this._elements[s]=this._type.create()},getElement:function(){return this._pointer>0?this._elements[--this._pointer]:null},disposeElement:function(e){this._elements[this._pointer++]=e}};return{create:function(t,s){var i=Object.create(e);return i.init(t,s),i}}}(),Vec2D=function(){var e={_x:1,_y:0,getX:function(){return this._x},setX:function(e){this._x=e},getY:function(){return this._y},setY:function(e){this._y=e},setXY:function(e,t){this._x=e,this._y=t},getLength:function(){return Math.sqrt(this._x*this._x+this._y*this._y)},setLength:function(e){var t=this.getAngle();this._x=Math.cos(t)*e,this._y=Math.sin(t)*e},getAngle:function(){return Math.atan2(this._y,this._x)},setAngle:function(e){var t=this.getLength();this._x=Math.cos(e)*t,this._y=Math.sin(e)*t},add:function(e){this._x+=e.getX(),this._y+=e.getY()},sub:function(e){this._x-=e.getX(),this._y-=e.getY()},mul:function(e){this._x*=e,this._y*=e},div:function(e){this._x/=e,this._y/=e}};return{create:function(t,s){var i=Object.create(e);return i.setXY(t,s),i}}}(),Particle=function(){var e={radius:null,color:null,lifeSpan:null,fric:null,pos:null,vel:null,blacklisted:null,update:function(){this.pos.add(this.vel),this.vel.mul(this.fric),this.radius-=.1,this.radius<.1&&(this.radius=.1),this.lifeSpan--<0&&(this.blacklisted=!0)},reset:function(){this.blacklisted=!1}};return{create:function(){var t=Object.create(e);return t.radius=2,t.color="#fff101",t.lifeSpan=0,t.fric=.98,t.pos=Vec2D.create(0,0),t.vel=Vec2D.create(0,0),t.blacklisted=!1,t}}}(),Bullet=function(){var e={radius:null,color:null,pos:null,vel:null,blacklisted:null,update:function(){this.pos.add(this.vel)},reset:function(){this.blacklisted=!1}};return{create:function(){var t=Object.create(e);return t.radius=4,t.color="#FFF",t.pos=Vec2D.create(0,0),t.vel=Vec2D.create(0,0),t.blacklisted=!1,t}}}(),Asteroid=function(){var e={radius:null,color:null,pos:null,vel:null,blacklisted:null,type:null,sides:null,angle:null,angleVel:null,update:function(){this.pos.add(this.vel),this.angle+=this.angleVel},reset:function(){this.blacklisted=!1}};return{create:function(){var t=Object.create(e);return t.radius=40,t.color="#FF5900",t.pos=Vec2D.create(0,0),t.vel=Vec2D.create(0,0),t.blacklisted=!1,t.type="b",t.sides=2*Math.random()+7>>0,t.angle=0,t.angleVel=.01*(1-2*Math.random()),t}}}(),Ship=function(){var e={angle:null,pos:null,vel:null,thrust:null,ref:null,bulletDelay:null,idle:null,radius:null,update:function(){this.vel.add(this.thrust),this.pos.add(this.vel),this.vel.getLength()>5&&this.vel.setLength(5),++this.bulletDelay,this.idle&&++this.idleDelay>120&&(this.idleDelay=0,this.idle=!1,this.ref.resetGame())},shoot:function(){this.bulletDelay>8&&(this.ref.generateShot(),this.bulletDelay=0)}};return{create:function(t,s,i){var l=Object.create(e);return l.ref=i,l.angle=0,l.pos=Vec2D.create(t,s),l.vel=Vec2D.create(0,0),l.thrust=Vec2D.create(0,0),l.idle=!1,l.radius=8,l.idleDelay=0,l}}}(),canvas,ctx,screenWidth,screenHeight,doublePI=2*Math.PI,score=0,ship,life=30,particlePool,particles,bulletPool,bullets,asteroidPool,asteroids,hScan,asteroidVelFactor=0,keyLeft=!1,keyUp=!1,keyRight=!1,keyDown=!1,keySpace=!1;window.getAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,16.6)},window.onload=function(){canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),window.onresize(),keyboardInit(),particleInit(),bulletInit(),asteroidInit(),shipInit(),loop()},window.onresize=function(){canvas&&(screenWidth=canvas.clientWidth,screenHeight=canvas.clientHeight,canvas.width=screenWidth,canvas.height=screenHeight,hScan=screenHeight/4>>0)};